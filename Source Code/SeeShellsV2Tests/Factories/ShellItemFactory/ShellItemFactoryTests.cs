using Microsoft.VisualStudio.TestTools.UnitTesting;
using SeeShellsV2.Factories;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

using Unity;

using SeeShellsV2.Data;
using SeeShellsV2.Repositories;

namespace SeeShellsV2.Factories.Tests
{
    [TestClass()]
    public class ShellItemFactoryTests
    {
        [TestMethod()]
        public void CreateTest()
        {
            IUnityContainer container = new UnityContainer();
            container.RegisterType<IConfig, Config>();

            ShellItemFactory factory = container.Resolve<ShellItemFactory>();

            IShellItem i1 = factory.Create(null, null, networkBuf);
            IShellItem i2 = factory.Create(null, null, fileBuf);
            IShellItem i3 = factory.Create(null, null, networkBufBad);
            IShellItem i4 = factory.Create(null, null, fileBufBad);

            Assert.IsTrue(i1 != null);
            Assert.IsTrue(i2 != null);
            Assert.IsTrue(i3 == null);
            Assert.IsTrue(i4 == null);

            Assert.IsTrue(i1.Type == 0xC3);
            Assert.IsTrue(i2.Type == 0x32);
        }

        private readonly byte[] networkBuf = new byte[]
        {
            0x31, 0x00, 0xC3, 0x01, 0xC1, 0x5C, 0x5C, 0x31,
            0x39, 0x32, 0x2E, 0x31, 0x36, 0x38, 0x2E, 0x38,
            0x30, 0x2E, 0x31, 0x32, 0x39, 0x5C, 0x55, 0x73,
            0x65, 0x72, 0x73, 0x00, 0x4D, 0x69, 0x63, 0x72,
            0x6F, 0x73, 0x6F, 0x66, 0x74, 0x20, 0x4E, 0x65,
            0x74, 0x77, 0x6F, 0x72, 0x6B, 0x00, 0x00, 0x02,
            0x00, 0x00, 0x00
        };

        private readonly byte[] networkBufBad = new byte[]
        {
            0x31, 0x00, 0xC3
        };

        private readonly byte[] fileBuf = new byte[] {
            0x88, 0x00, 0x32, 0x00, 0xC3, 0x52, 0x7D, 0x00,
            0x85, 0x47, 0x1A, 0xA7, 0x20, 0x00, 0x41, 0x54,
            0x4B, 0x5F, 0x50, 0x41, 0x7E, 0x31, 0x2E, 0x5A,
            0x49, 0x50, 0x00, 0x00, 0x6C, 0x00, 0x08, 0x00,
            0x04, 0x00, 0xEF, 0xBE, 0x98, 0x47, 0x94, 0xB9,
            0x98, 0x47, 0x94, 0xB9, 0x2A, 0x00, 0x00, 0x00,
            0x64, 0xE9, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41, 0x00,
            0x54, 0x00, 0x4B, 0x00, 0x5F, 0x00, 0x50, 0x00,
            0x61, 0x00, 0x63, 0x00, 0x6B, 0x00, 0x61, 0x00,
            0x67, 0x00, 0x65, 0x00, 0x5F, 0x00, 0x77, 0x00,
            0x69, 0x00, 0x6E, 0x00, 0x37, 0x00, 0x5F, 0x00,
            0x33, 0x00, 0x32, 0x00, 0x5F, 0x00, 0x5A, 0x00,
            0x31, 0x00, 0x30, 0x00, 0x30, 0x00, 0x30, 0x00,
            0x30, 0x00, 0x38, 0x00, 0x2E, 0x00, 0x7A, 0x00,
            0x69, 0x00, 0x70, 0x00, 0x00, 0x00, 0x1C, 0x00,
            0x00, 0x00
        };

        private readonly byte[] fileBufBad = new byte[] {
            0x88, 0x00, 0x32, 0x00, 0xC3, 0x52, 0x7D, 0x00,
            0x85, 0x47, 0x1A, 0xA7, 0x20
        };
    }
}